<% content_for :course_title_actions do %>
<div class="row">
  <% if user_signed_in? %>
  <div class="col-sm-8">
    <div class="actions">
    <% unless @user.enrolled?(:course => @section.course) || @user.instructing?(:section => @section) %>
      <%= link_to "Enroll", enroll_course_section_path(@course, @section), method: :post, class:'btn btn-primary' %>
    <% end %>
    <% if @user.enrolled?(:section => @section) %>
      <%= link_to "Drop course", drop_course_section_path(@course, @section), method: :delete, class:'btn btn-default' %>
    <% end %>
    <% if can? :update, @section %>
      <%= link_to edit_course_section_path(@course, @section), class: 'btn btn-default' do %>
        <span class="glyphicon glyphicon-pencil"></span> Edit
      <% end %>
    <% end %>
    <% if can? :destroy, @section %>
      <%= link_to [@course, @section], method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-default' do %>
        <span class="glyphicon glyphicon-trash"></span> Delete
      <% end %>
    <% end %>
    </div>
  </div>
    <% if can? :enroll_user, @section %>
    <div class="col-sm-4 text-right">
      <%= form_tag enroll_user_course_section_path, :role => 'form' do %>
        <div class="form-group">
          <div class="input-group">
            <%= text_field_tag :username, nil, :placeholder => 'Username or eID', :class => 'form-control' %>
            <div class="input-group-btn">
              <button class="btn btn-default" type="submit">Enroll user</button>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <% end %>
  <% else %>
  <div class="col-sm-12">
    <%= link_to "Enroll", enroll_course_section_path(@course, @section), method: :post, class:'btn btn-primary' %>
  </div>
  <% end %>
</div>
<% end %>

<%= render partial: 'courses/title_heading', locals: { course: @course,
                                                       link_title: true } %>

<div class="summary">
  <ul class="list-unstyled">
    <li>
      <strong>Section Number:</strong>
      <%= @section.section_number %>
    </li>

    <li>
      <strong>Instructor:</strong>
      <%= @section.instructor.display_name %>
    </li>

    <li>
      <strong>Open Seats:</strong>
      <%= @section.open_seats %> / <%= @section.seats %>
    </li>
  </ul>

  <div class="hidden-print">
    <%= render @section.parts %>
  </div>
  <div class="visible-print-block">
  <% @section.parts.each do |part| %>
    <strong><%= part.date_and_time %></strong> &mdash; <%= part.location %><br />
  <% end %>
  </div>
</div>

<% if can? :view_enrollments, @section %>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Course Roster</h3>
  </div>
  <% if @section.enrollments.any? %>
  <div class="table-responsive">
    <table class="table table-striped roster-list">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Department</th>
        </tr>
      </thead>
      <tbody>
      <% @section.enrollments.each do |enrollment| %>
        <tr>
          <td><%= enrollment.user.display_name %></td>
          <td><%= enrollment.user.email %></td>
          <td><%= enrollment.user.phone_number %></td>
          <td><%= enrollment.user.department %></td>
        </tr>
      <% end %>
      </tbody>
    </table>
  </div>
  <% else %>
  <div class="panel-body">
    <p>There isn't anyone enrolled in this section.</p>
  </div>
  <% end %>
</div>
<% end %>
