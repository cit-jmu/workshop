<% if can?(:update, @course) || can?(:destroy, @course) %>
<div class="admin-actions pull-right">
  <% if can?(:update, @course) %>
    <%= link_to edit_course_path(@course), title: 'Edit', class: 'btn btn-default' do %>
      <span class="glyphicon glyphicon-pencil"></span>
    <% end %>
  <% end %>
  <% if can?(:destroy, @course) %>
    <%= link_to @course, method: :delete, title: 'Delete', class: 'btn btn-default', data: { confirm: 'Are you sure?' } do %>
      <span class="glyphicon glyphicon-trash"></span>
    <% end %>
  <% end %>
</div>
<% end %>

<%= render partial: 'title_heading', locals: { course: @course } %>

<ul class="list-unstyled">
  <li><strong>Course Number:</strong> <%= @course.course_number %></li>
  <li><strong>Duration:</strong> <%= pluralize(@course.duration, "minute") %><li>
</ul>

<article class="markdown-body description">
  <%= @course.description_html %>
</article>
<div class="panel panel-default available-sections">
  <div class="panel-heading">
    <% if can? :create, Section %>
    <div class="admin-actions pull-right">
      <%= link_to "Add section", new_course_section_path(@course) %>
    </div>
    <% end %>
    <h3 class="panel-title">
      <% if can? :read, Section %>
      <%= link_to "Available sections", course_sections_path(@course) %>
      <% else %>
      Available sections
      <% end %>
    </h3>
  </div>
  <% if @course.sections.any? %>
  <table class="table">
    <thead>
      <tr>
        <th>Section</th>
        <th>Open Seats</th>
        <th>Date and Time</th>
        <th>Instructor</th>
        <th>Location</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
    <% @course.sections.order(:section_number).each do |section| %>
      <tr class="<%= css_class_for_section_row(section) %>">
        <td rowspan="<%= section.parts.count %>">
          <%= link_to section.section_number, course_section_path(@course, section) %>
        </td>
        <td rowspan="<%= section.parts.count %>"><%= section.open_seats %></td>
        <td><%= section.parts.first.date_and_time %></td>
        <td><%= section.parts.first.instructor.full_name %></td>
        <td><%= section.parts.first.location %></td>
        <td class="text-right" rowspan="<%= section.parts.count %>">
        <% if current_user %>
          <% if current_user.enrolled?(section) %>
            <%= link_to 'Drop', drop_course_section_path(@course, section), method: :delete, class: 'btn btn-default' %>
          <% elsif !current_user.instructing?(section) && !current_user.enrolled?(section.course)  %>
            <%= link_to 'Enroll', enroll_course_section_path(@course, section), method: :post, class: 'btn btn-primary' %>
          <% end %>
        <% else %>
            <%= link_to 'Enroll', enroll_course_section_path(@course, section), method: :post, class: 'btn btn-primary' %>
        <% end %>
        </td>
      </tr>
      <% section.parts[1..-1].each do |part| %>
      <tr class="<%= css_class_for_section_row(section) %>">
        <td><%= part.date_and_time %></td>
        <td><%= part.instructor.full_name %></td>
        <td><%= part.location %></td>
      </tr>
      <% end %>
    <% end %>
    </tbody>
  </table>
  <% else %>
  <div class="panel-body">
    There aren't any sections available at this time.  Please check back later.
  </div>
  <% end %>
</div>
