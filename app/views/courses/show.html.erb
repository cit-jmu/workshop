<% if can?(:update, @course) || can?(:destroy, @course) %>
<div class="admin-actions pull-right">
  <% if can?(:update, @course) %>
    <%= link_to edit_course_path(@course), title: 'Edit', class: 'btn btn-default' do %>
      <span class="glyphicon glyphicon-pencil"></span>
    <% end %>
  <% end %>
  <% if can?(:destroy, @course) %>
    <%= link_to @course, method: :delete, title: 'Delete', class: 'btn btn-default', data: { confirm: 'Are you sure?' } do %>
      <span class="glyphicon glyphicon-trash"></span>
    <% end %>
  <% end %>
</div>
<% end %>

<h2>
  <%= @course.title %>
  <% if current_user and current_user.enrolled? @course %>
    <span class="label label-success">Enrolled</span>
  <% end %>
</h2>

<ul class="list-unstyled">
  <li><strong>Course Number:</strong> <%= @course.course_number %></li>
  <li><strong>Duration:</strong> <%= pluralize(@course.duration, "minute") %><li>
</ul>

<article class="markdown-body description">
  <%= @course.description_html %>
</article>
<div class="panel panel-default available-sections">
  <div class="panel-heading">
    <% if can? :create, Section %>
    <div class="admin-actions pull-right">
      <%= link_to "Add section", new_course_section_path(@course) %>
    </div>
    <% end %>
    <h3 class="panel-title">
      <% if can? :read, Section %>
      <%= link_to "Available sections", course_sections_path(@course) %>
      <% else %>
      Available sections
      <% end %>
    </h3>
  </div>
  <% if @course.sections.any? %>
  <table class="table">
    <thead>
      <tr>
        <th>Section</th>
        <th>Date and Time</th>
        <th>Instructor</th>
        <th>Location</th>
        <th>Open Seats</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @course.sections.each do |section| %>
      <tr class="<%= css_class_for_section_row(section) %>">
        <td>
        <% if can? :update, section %>
          <%= link_to section.section_number, edit_course_section_path(@course, section) %>
        <% else %>
          <%= section.section_number %>
        <% end %>
        </td>
        <td><%= section.date_and_time %></td>
        <td><%= section.instructor.full_name %></td>
        <td><%= section.location %></td>
        <td><%= section.open_seats %></td>
        <td class="text-right">
        <% if @enrolled_section == section %>
          <%= link_to 'Drop course', drop_course_section_path(@course, section), method: :delete, class: 'btn btn-default' %>
        <% elsif @enrolled_section.nil? %>
          <%= link_to 'Enroll', enroll_course_section_path(@course, section), method: :post, class: 'btn btn-primary' %>
        <% end %>
        </td>
      </tr>
      <% end %>
    </tbody>
  </table>
  <% else %>
  <div class="panel-body">
    There aren't any sections available at this time.  Please check back later.
  </div>
  <% end %>
</div>
